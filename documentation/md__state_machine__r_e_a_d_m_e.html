<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BGC Tools: State Machine</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BGC Tools
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">State Machine </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This state machine has been implemented as a generic solution to implementing state machines in C# with Unity. It is also a response to a previously tested method with using the <a href="https://docs.unity3d.com/Manual/AnimationStateMachines.html">Unity Animation State Machine</a> which while powerful and <a href="https://www.google.com/search?q=unity+animation+state+machine&amp;client=firefox-b-1-d&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=0ahUKEwj5_Ljl7NLhAhVZIDQIHRu6AlUQ_AUIDigB&amp;biw=1920&amp;bih=983#imgrc=ap47IpO2-J87lM:">visual</a>, it is frame capped. We do, however, implement similar functionality to the animation state machine.</p>
<h2>Trigger and Bool Transitions</h2>
<p>A state can be transitioned through either triggers or bools. A trigger is a boolean that once used by a state to transition will be consumed. Meaning that if I have three states connected that used the same trigger condition to transiiton, I would have to activate the trigger each time to transition. In this same situation, where they require a bool instead of a trigger, though, all three states will transition in the same frame.</p>
<h2>States</h2>
<p>Every state will implement the <code>State</code> class which provides <code>OnStateEnter</code> and <code>OnStateExit</code> as functions that must be overrode. They can also implement an <code>Update</code> function. For this to be called, the state machine must be called in a <code><a class="el" href="class_mono_behaviour.html">MonoBehaviour</a></code> class <code>Update</code> call.</p>
<h2>Extra Notes</h2>
<p>The example provided below is very simplistic and only to show a basic use case. More complex use cases will typically have states take in arguments as a way to handle game state. As an example, in several of our own games we use this state machine to implement the entire game loop and menu management.</p>
<h2>Example</h2>
<h3>Code</h3>
<div class="fragment"><div class="line">{c#}</div><div class="line">using UnityEngine;</div><div class="line">using BGC.StateMachine;</div><div class="line"></div><div class="line">public class EntryState : State</div><div class="line">{</div><div class="line">    protected override string DefaultName =&gt; &quot;EntryState&quot;;</div><div class="line"></div><div class="line">    protected override void OnStateEnter()</div><div class="line">    {</div><div class="line">        ActivateTrigger(&quot;nextstate&quot;);</div><div class="line">    }</div><div class="line"></div><div class="line">    // pass, ignore the bad styling for the sake of brevity</div><div class="line">    protected override void OnStateExit() {}</div><div class="line">}</div><div class="line"></div><div class="line">public class RandomPrintState : State</div><div class="line">{</div><div class="line">    protected override string DefaultName =&gt; &quot;RandomPrint&quot;;</div><div class="line"></div><div class="line">    protected override void OnStateEnter()</div><div class="line">    {</div><div class="line">        if (Random.Range(0f, 1f) &gt;= 0.5f)</div><div class="line">        {</div><div class="line">            Debug.Log(&quot;I am greater than or equal to 0.5f&quot;);</div><div class="line">        }</div><div class="line">        else</div><div class="line">        {</div><div class="line">            Debug.Log(&quot;I am less than 0.5f&quot;);</div><div class="line">        }</div><div class="line"></div><div class="line">        ActivateTrigger(&quot;nextstate&quot;);</div><div class="line">    }</div><div class="line"></div><div class="line">    // pass, ignore the bad styling for the sake of brevity</div><div class="line">    protected override void OnStateExit() {}</div><div class="line">}</div><div class="line"></div><div class="line">public class HelloWorldState : State</div><div class="line">{</div><div class="line">    protected override string DefaultName =&gt; &quot;Hello world&quot;;</div><div class="line"></div><div class="line">    protected override void OnStateEnter()</div><div class="line">    {</div><div class="line">        Debug.Log(&quot;hello world&quot;);</div><div class="line"></div><div class="line">        // 50/50 chance that the bool is set to true or false which defines</div><div class="line">        // which state we transition to next</div><div class="line">        SetBool(&quot;nextstate&quot;, Random.Range(0f, 1f) &gt;= 0.5f);</div><div class="line">    }</div><div class="line"></div><div class="line">    // pass, ignore the bad styling for the sake of brevity</div><div class="line">    protected override void OnStateExit() {}</div><div class="line">}</div><div class="line"></div><div class="line">public class ExitState : State</div><div class="line">{</div><div class="line">    protected override string DefaultName =&gt; &quot;Exit State&quot;;</div><div class="line"></div><div class="line">    protected override void OnStateEnter() {}</div><div class="line">    protected override void OnStateExit() {}</div><div class="line">}</div><div class="line"></div><div class="line">public class ExampleStateMachineImplementation : MonoBehaviour</div><div class="line">{</div><div class="line">    private void Start()</div><div class="line">    {</div><div class="line">        StateMachine stateMachine = new StateMachine(verbose: true);</div><div class="line"></div><div class="line">        EntryState entryState = new EntryState();</div><div class="line">        HelloWorldState helloWorldState = new HelloWorldState();</div><div class="line">        RandomPrintState randomPrintState = new RandomPrintState();</div><div class="line">        ExitState exitState = new ExitState();</div><div class="line"></div><div class="line">        stateMachine.AddEntryState(entryState);</div><div class="line">        stateMachine.AddState(helloWorldState);</div><div class="line">        stateMachine.AddState(randomPrintState);</div><div class="line">        stateMachine.AddState(exitState);</div><div class="line"></div><div class="line">        stateMachine.AddTransition(</div><div class="line">            entryState,</div><div class="line">            helloWorldState,</div><div class="line">            new TriggerCondition(&quot;nextstate&quot;));</div><div class="line"></div><div class="line">        stateMachine.AddTransition(</div><div class="line">            helloWorldState,</div><div class="line">            randomPrintState,</div><div class="line">            new BoolCondition(&quot;nextstate&quot;, true));</div><div class="line"></div><div class="line">        stateMachine.AddTransition(</div><div class="line">            helloWorldState,</div><div class="line">            exitState,</div><div class="line">            new BoolCondition(&quot;nextstate&quot;, false));</div><div class="line"></div><div class="line">        stateMachine.AddTransition(</div><div class="line">            randomPrintState,</div><div class="line">            exitState,</div><div class="line">            new TriggerCondition(&quot;nextstate&quot;));</div><div class="line"></div><div class="line">        stateMachine.Start();</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h3>Output</h3>
<p>Please note that the output is the output from when the state machine has verbose set to true. If verbose was set to false, then the log lines with "entered" or "left" would not be logged.</p>
<h4>1</h4>
<p>This is the output when <code>RandomPrintState</code> is not entered.</p>
<div class="fragment"><div class="line">EntryState entered.</div><div class="line">EntryState left.</div><div class="line">Hello world entered.</div><div class="line">hello world</div><div class="line">Hello world left.</div><div class="line">Exit State entered.</div></div><!-- fragment --><h4>2</h4>
<p>This is the output when <code>RandomPrintState</code> is entered</p>
<div class="fragment"><div class="line">EntryState entered.</div><div class="line">EntryState left.</div><div class="line">Hello world entered.</div><div class="line">hello world</div><div class="line">Hello world left.</div><div class="line">RandomPrint entered.</div><div class="line">I am greater than or equal to 0.5f</div><div class="line">RandomPrint left.</div><div class="line">Exit State entered.</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jun 3 2019 11:21:28 for BGC Tools by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
